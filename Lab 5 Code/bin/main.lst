
Freescale HC12-Assembler 
(c) Copyright Freescale 1987-2010

 Abs. Rel.   Loc    Obj. code   Source line
 ---- ----   ------ ---------   -----------
    1    1                      ;**************************************************************************************
    2    2                      ;* Lab 5                                                                            *
    3    3                      ;**************************************************************************************
    4    4                      ;* Summary:                                                                           *
    5    5                      ;*                                     *
    6    6                      ;*                                                                                    *
    7    7                      ;* Author: Nathan Burtnett, Tom Taylor                                                *
    8    8                      ;*   Cal Poly University                                                              *
    9    9                      ;*   Fall 2022                                                                        *
   10   10                      ;*                                                                                    *
   11   11                      ;* Revision History:                                                                  *
   12   12                      ;*   -                                                                                *                                             
   13   13                      ;**************************************************************************************
   14   14                      
   15   15                      ;/------------------------------------------------------------------------------------\
   16   16                      ;| External Definitions                                                               |
   17   17                      ;\------------------------------------------------------------------------------------/
   18   18                                    XDEF  main
   19   19                      ;/------------------------------------------------------------------------------------\
   20   20                      ;| External References                                                                |
   21   21                      ;\------------------------------------------------------------------------------------/
   22   22                                    XREF  ENABLE_MOTOR, DISABLE_MOTOR
   23   23                                    XREF  STARTUP_MOTOR, UPDATE_MOTOR, CURRENT_MOTOR
   24   24                                    XREF  STARTUP_PWM, STARTUP_ATD0, STARTUP_ATD1
   25   25                                    XREF  OUTDACA, OUTDACB
   26   26                                    XREF  STARTUP_ENCODER, READ_ENCODER
   27   27                                    XREF  INITLCD, SETADDR, GETADDR, CURSOR_ON, CURSOR_OFF, DISP_OFF
   28   28                                    XREF  OUTCHAR, OUTCHAR_AT, OUTSTRING, OUTSTRING_AT
   29   29                                    XREF  INITKEY, LKEY_FLG, GETCHAR
   30   30                                    XREF  LCDTEMPLATE, UPDATELCD_L1, UPDATELCD_L2
   31   31                                    XREF  LVREF_BUF, LVACT_BUF, LERR_BUF,LEFF_BUF, LKP_BUF, LKI_BUF
   32   32                                    XREF  Entry, ISR_KEYPAD
   33   33                                  
   34   34                      ;/------------------------------------------------------------------------------------\
   35   35                      ;| Assembler Equates                                                                  |
   36   36                      ;\------------------------------------------------------------------------------------/
   37   37                      ;INTERRUPT EQUATES
   38   38          0000 03E8   INTERVAL      EQU   $03E8     ;sets interval
   39   39                      
   40   40          0000 0040   TIOS          EQU   $0040     ;sets location of TIOS
   41   41          0000 0001   C0            EQU   %00000001 ;sets value of C0 which will go into TIOS
   42   42                      
   43   43          0000 0049   TCTL2         EQU   $0049     ;sets location of TCTL2
   44   44          0000 0001   CROA_TOGGLE   EQU   %00000001 ;sets value of CROA_TOGGLE which will go into TIOS
   45   45                      
   46   46          0000 004E   TFLG1         EQU   $004E     ;sets location of TFLG1
   47   47          0000 0001   C0F_CLEAR     EQU   %00000001 ;sets value C0F_CLEAR which will go into TFLG1
   48   48                      
   49   49          0000 004C   TIE           EQU   $004C     ;sets location of TIE
   50   50          0000 0001   C0I_SET       EQU   %00000001 ;sets value C0I_SET which will go into TIE
   51   51                      
   52   52          0000 0046   TSCR1         EQU   $0046     ;sets location of TSCR1
   53   53          0000 00A0   TEN_TSFRZ_SET EQU   %10100000 ;sets value TEN_TSFRZ_SET which will go into TSCR1
   54   54          0000 0044   TCNT          EQU   $0044     ;sets location of TCNT
   55   55          0000 0050   TC0H          EQU   $0050     ;sets location of TC0H
   56   56                      ;/------------------------------------------------------------------------------------\
   57   57                      ;| Variables in RAM                                                                   |
   58   58                      ;\------------------------------------------------------------------------------------/
   59   59                      DEFAULT_RAM:  SECTION
   60   60                      
   61   61   000000             ENCODER_COUNT   DS.W 1  ;stores a count for enocoder
   62   62                      ;/------------------------------------------------------------------------------------\
   63   63                      ;|  Main Program Code                                                                 |
   64   64                      ;\------------------------------------------------------------------------------------/

Freescale HC12-Assembler 
(c) Copyright Freescale 1987-2010

 Abs. Rel.   Loc    Obj. code   Source line
 ---- ----   ------ ---------   -----------
   65   65                      MyCode:       SECTION
   66   66                      main:
   67   67                        ;CLEAR VARIABLES 
   68   68                      
   69   69                        ;SETUP INSTRUCTIONS
   70   70   000000 16xx xx       jsr STARTUP_ENCODER   ;initialize encoder
   71   71   000003 16xx xx       jsr READ_ENCODER      ;returns encoder count in D
   72   72   000006 7Cxx xx       std ENCODER_COUNT     ;store the count in a 16-bit variable in RAM
   73   73                      
   74   74   000009 16xx xx       jsr STARTUP_PWM       ;initialize PWM module
   75   75   00000C 16xx xx       jsr STARTUP_MOTOR     ;initialize motor in disabled state
   76   76                      
   77   77   00000F 16xx xx       jsr ENABLE_MOTOR      ;enable motor operation
   78   78                      
   79   79                        TOP:
   80   80                      
   81   81   000012 CC00 00         ldd #$0000 ; load accumulator D with 313
   82   82   000015 16xx xx         jsr UPDATE_MOTOR ; actuate the motor at 50% duty cycle
   83   83   000018 16xx xx         jsr READ_ENCODER
   84   84   00001B 7Cxx xx         std ENCODER_COUNT
   85   85   00001E 20F2            bra TOP               ;go back to TOP and loop through endlessly
   86   86                          
   87   87                          
   88   88   000020 CCFE C7         ldd #$FEC7 ; load accumulator D with -313
   89   89   000023 16xx xx         jsr UPDATE_MOTOR ; actuate the motor at -50% duty cycle
   90   90   000026 00              bgnd
   91   91                      
   92   92   000027 CC80 00         ldd #$8000 ; load accumulator D with -32768
   93   93   00002A 16xx xx         jsr UPDATE_MOTOR ; brake the motor at 100% dut
   94   94   00002D 00              bgnd
   95   95                          
   96   96                          
   97   97                        
   98   98                      
   99   99                      ;/------------------------------------------------------------------------------------\
  100  100                      ;| Subroutines                                                                        |
  101  101                      ;\------------------------------------------------------------------------------------/
  102  102                         
  103  103                      
  104  104                      ;/------------------------------------------------------------------------------------\
  105  105                      ;| ASCII Messages and Constant Data                                                   |
  106  106                      ;\------------------------------------------------------------------------------------/
  107  107                      
  108  108                      ;/------------------------------------------------------------------------------------\
  109  109                      ;| Vectors                                                                            |
  110  110                      ;\------------------------------------------------------------------------------------/
  111  111                        ORG   $FFFE                    ; reset vector address
  112  112  a00FFFE xxxx          DC.W  Entry
  113  113                        ORG   $FFCE                    ; Key Wakeup interrupt vector address [Port J]
  114  114  a00FFCE xxxx          DC.W  ISR_KEYPAD
