
Freescale HC12-Assembler 
(c) Copyright Freescale 1987-2010

 Abs. Rel.   Loc    Obj. code   Source line
 ---- ----   ------ ---------   -----------
    1    1                      ;**************************************************************************************
    2    2                      ;* Blank Project Main [includes LibV2.2]                                              *
    3    3                      ;**************************************************************************************
    4    4                      ;* Summary:                                                                           *
    5    5                      ;*   -                                                                                *
    6    6                      ;*                                                                                    *
    7    7                      ;* Author: YOUR NAME                                                                  *
    8    8                      ;*   Cal Poly University                                                              *
    9    9                      ;*   Spring 2022                                                                      *
   10   10                      ;*                                                                                    *
   11   11                      ;* Revision History:                                                                  *
   12   12                      ;*   -                                                                                *
   13   13                      ;*                                                                                    *
   14   14                      ;* ToDo:                                                                              *
   15   15                      ;*   -                                                                                *
   16   16                      ;**************************************************************************************
   17   17                      
   18   18                      ;/------------------------------------------------------------------------------------\
   19   19                      ;| Include all associated files                                                       |
   20   20                      ;\------------------------------------------------------------------------------------/
   21   21                      ; The following are external files to be included during assembly
   22   22                                    XDEF  main
   23   23                                    XDEF  Theta_OLD, RUN, CL, V_ref, KP, KI, UPDATE_FLG1  
   24   24                      ;/------------------------------------------------------------------------------------\
   25   25                      ;| External References                                                                |
   26   26                      ;\------------------------------------------------------------------------------------/
   27   27                      ; All labels from other files must have an external reference
   28   28                      
   29   29                                    XREF  ENABLE_MOTOR, DISABLE_MOTOR
   30   30                                    XREF  STARTUP_MOTOR, UPDATE_MOTOR, CURRENT_MOTOR 
   31   31                                    XREF  STARTUP_PWM, STARTUP_ATD0, STARTUP_ATD1   
   32   32                                    XREF  OUTDACA, OUTDACB
   33   33                                    XREF  STARTUP_ENCODER, READ_ENCODER
   34   34                                    XREF  DELAY_MILLI, DELAY_MICRO
   35   35                                    XREF  INITLCD, SETADDR, GETADDR, CURSOR_ON, CURSOR_OFF, DISP_OFF
   36   36                                    XREF  OUTCHAR, OUTCHAR_AT, OUTSTRING, OUTSTRING_AT
   37   37                                    XREF  INITKEY, LKEY_FLG, GETCHAR
   38   38                                    XREF  LCDTEMPLATE, UPDATELCD_L1, UPDATELCD_L2
   39   39                                    XREF  LVREF_BUF, LVACT_BUF, LERR_BUF,LEFF_BUF, LKP_BUF, LKI_BUF
   40   40                                    XREF  Entry, ISR_KEYPAD
   41   41                                  
   42   42                                    XREF  V_act_DISP, ERR_DISP, EFF_DISP, INTERVAL
   43   43                                    XREF  FREDENTRY, Kscale
   44   44                                  
   45   45                      ;/------------------------------------------------------------------------------------\
   46   46                      ;| Assembler Equates                                                                  |
   47   47                      ;\------------------------------------------------------------------------------------/
   48   48                      ; Constant values can be equated here
   49   49                      
   50   50                      
   51   51          0000 004E   TFLG1         EQU   $004E
   52   52          0000 0050   TC0           EQU   $0050
   53   53          0000 0001   C0F           EQU   %00000001          ; timer channel 0 output compare bit
   54   54          0000 0240   PORTT         EQU   $0240              ; PORTT pin 8 to be used for interrupt timing
   55   55          FFFF FD8F   LOWER_LIM     EQU   -625               ; number for max reverse duty cycle
   56   56          0000 0271   UPPER_LIM     EQU   625                ; number for max forward duty cycle
   57   57                      
   58   58                      
   59   59                      ;/------------------------------------------------------------------------------------\
   60   60                      ;| Variables in RAM                                                                   |
   61   61                      ;\------------------------------------------------------------------------------------/
   62   62                      ; The following variables are located in unpaged ram
   63   63                      
   64   64                      DEFAULT_RAM:  SECTION

Freescale HC12-Assembler 
(c) Copyright Freescale 1987-2010

 Abs. Rel.   Loc    Obj. code   Source line
 ---- ----   ------ ---------   -----------
   65   65                      
   66   66   000000             RUN:          DS.B  1                  ; Boolean indicating controller is running
   67   67   000001             CL:           DS.B  1                  ; Boolean for closed-loop active
   68   68                      
   69   69   000002             V_ref:        DS.W  1                  ; reference velocity
   70   70   000004             V_act:        DS.W  1                  ; actual velocity
   71   71   000006             Theta_NEW:    DS.W  1                  ; new encoder position
   72   72   000008             Theta_OLD:    DS.W  1                  ; previous encoder reading
   73   73   00000A             KP:           DS.W  1                  ; proportional gain
   74   74   00000C             KI:           DS.W  1                  ; integral gain
   75   75                      
   76   76   00000E             ERR:          DS.W  1                  ; error, where ERR = V_ref - V_act
   77   77   000010             EFF:          DS.W  1                  ; effort
   78   78   000012             ESUM:         DS.W  1                  ; accumulated error (area under err vs. t curve)
   79   79                      
   80   80   000014             UPDATE_COUNT: DS.B  1                  ; counter for display update
   81   81   000015             UPDATE_FLG1   DS.B  1                  ; Boolean for display update for line one
   82   82                      
   83   83   000016             MOTOR_POWER:  DS.W  1                  ; motor actuation value
   84   84   000018             P_POWER:      DS.W  1                  ; P-term of motor actuation value
   85   85   00001A             I_POWER:      DS.W  1                  ; I-term of motor actuation value
   86   86                      
   87   87   00001C             CURRENT:      DS.W  1                  ; motor current in mA
   88   88                      
   89   89                      
   90   90                      ;/------------------------------------------------------------------------------------\
   91   91                      ;|  Main Program Code                                                                 |
   92   92                      ;\------------------------------------------------------------------------------------/
   93   93                      ; Your code goes here
   94   94                      
   95   95                      MyCode:       SECTION
   96   96                      main:   
   97   97                              
   98   98   000000 20FE        spin:   bra   spin                     ; endless horizontal loop
   99   99                      
  100  100                      
  101  101                      ;/------------------------------------------------------------------------------------\
  102  102                      ;| Subroutines                                                                        |
  103  103                      ;\------------------------------------------------------------------------------------/
  104  104                      ; General purpose subroutines go here
  105  105                      
  106  106                      
  107  107                      ;/------------------------------------------------------------------------------------\
  108  108                      ;| ASCII Messages and Constant Data                                                   |
  109  109                      ;\------------------------------------------------------------------------------------/
  110  110                      ; Any constants can be defined here
  111  111                      
  112  112                      
  113  113                      ;/------------------------------------------------------------------------------------\
  114  114                      ;| Vectors                                                                            |
  115  115                      ;\------------------------------------------------------------------------------------/
  116  116                      ; Add interrupt and reset vectors here
  117  117                               ORG  $FFFE                    ; reset vector address
  118  118  a00FFFE xxxx                 DC.W Entry
  119  119                      ;         ORG  $FFEE                    ; Timer Channel 0 interrupt vector address
  120  120                      ;         DC.W TC0ISR
